<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JFG Metais — Demo (React → HTML) - Loja</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Helper transitions */
    .fade-enter { opacity: 0; transform: translateY(10px); transition: all .22s ease; }
    .fade-enter.fade-enter-active { opacity: 1; transform: translateY(0); }
    .pressed { transform: scale(.98); transition: transform .05s; }
    img { max-width: 100%; display:block; }
    button:focus, a:focus, input:focus, textarea:focus { outline: 3px solid rgba(255,165,0,0.25); outline-offset: 2px; }
    .thin-scroll::-webkit-scrollbar { height: 8px; width: 8px; }
    .thin-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 8px; }
    /* floating cart specifics */
    .cart-root { transition: transform .18s ease, opacity .18s ease; }
    .cart-minimized { width: 12rem; padding: .5rem .75rem; border-radius: .75rem; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    .cart-expanded { width: 20rem; max-height: 60vh; padding: .75rem; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.12); display:flex; flex-direction:column; }
    .cart-items { overflow:auto; max-height:36vh; }
    .overlay-backdrop { background: rgba(0,0,0,0.45); position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:60; }
    .detail-card { width:95%; max-width:900px; max-height:90vh; overflow:auto; border-radius:12px; background:#fff; padding:1rem; box-shadow:0 18px 60px rgba(0,0,0,0.3); }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">

  <div id="app"></div>

  <script>
    /*************************
     * Config / Dados
     *************************/
    const BRAND = {
      name: 'JFG Metais',
      phone: '+55 11 94214-7315',
      waNumberClean: '5511974177315',
      heroTags: ['JFG Metais', 'Loja Online', 'Faça Seu Pedido', 'Qualidade Garantida'],
      logoImage: 'logo.jpeg',
    };

    const productsSeed = [
      { id: 1, title: 'Grapa Reta 5cm', basePrice: 0.50, images: ['1.png'], category: 'Grapas', tag: 'Destaque', excerpt: 'Grapa em aço carbono, resistente para fixações.', sizes: [{ id: 'p100', label: 'P (50 unid)', price: 24.9 },{ id: 'm100', label: 'M (100 unid)', price: 44.9 },{ id: 'g200', label: 'G (200 unid)', price: 79.9 }] },
      { id: 2, title: 'Mão Francesa Média', basePrice: 19.9, images: ['https://via.placeholder.com/800x800?text=Mao+Francesa+1'], category: 'Mão francesas', tag: 'Promo', excerpt: 'Suporte em L com pintura eletrostática.', sizes: [{ id: '30', label: '30 cm', price: 19.9 },{ id: '40', label: '40 cm', price: 24.9 },{ id: '50', label: '50 cm', price: 29.9 }] },
      { id: 3, title: 'Cavalete de Obras', basePrice: 129.0, images: ['https://via.placeholder.com/800x800?text=Cavalete+1','https://via.placeholder.com/800x800?text=Cavalete+2'], category: 'Cavaletes', tag: '', excerpt: 'Cavalete dobrável, ideal para canteiro.', sizes: [{ id: '1m', label: '1 m', price: 129.0 },{ id: '1.5m', label: '1.5 m', price: 149.0 }] },
    ];

    const productsFull = [
      ...productsSeed,
      { id: 4, title: 'Kit Acessórios de Fixação', basePrice: 39.9, images: ['5.png'], category: 'Acessórios', tag: 'Novo', excerpt: 'Parafusos, buchas e pequenos itens para acabamento.', sizes: [{ id: 'mini', label: 'Mini (50 pcs)', price: 19.9 },{ id: 'standard', label: 'Padrão (150 pcs)', price: 39.9 },{ id: 'pro', label: 'Pro (300 pcs)', price: 69.9 }] },
      { id: 5, title: 'Grapa Curvada 7cm', basePrice: 0.75, images: ['https://via.placeholder.com/800x800?text=Grapa+2-1'], category: 'Grapas', tag: '', excerpt: 'Grapa com curvatura para aplicações especiais.', sizes: [{ id: 'p50', label: 'P (50 unid)', price: 29.9 },{ id: 'm100', label: 'M (100 unid)', price: 54.9 }] },
      { id: 6, title: 'Mão Francesa Reforçada', basePrice: 34.9, images: ['https://via.placeholder.com/800x800?text=Mao+2-1','https://via.placeholder.com/800x800?text=Mao+2-2'], category: 'Mão francesas', tag: 'Top', excerpt: 'Para cargas pesadas e prateleiras industriais.', sizes: [{ id: '40', label: '40 cm', price: 34.9 },{ id: '60', label: '60 cm', price: 49.9 }] },
      { id: 7, title: 'Cavalete Metálico Profissional', basePrice: 199.0, images: ['https://via.placeholder.com/800x800?text=Cavalete+Prof'], category: 'Cavaletes', tag: '', excerpt: 'Construção robusta para uso profissional.', sizes: [{ id: '1.2m', label: '1.2 m', price: 199.0 },{ id: '2m', label: '2 m', price: 249.0 }] },
    ];

    /*************************
     * Estado
     *************************/
    let route = 'home';
    let products = [...productsFull];
    let featured = [...productsSeed];
    let cart = JSON.parse(localStorage.getItem('jfg_cart') || '[]');
    let toastMsg = '';
    let toastTimer = null;
    let heroIndex = 0;
    let productDetailOverlay = null;
    let cartMinimized = false; // controla estado minimizado do popup

    /*************************
     * Utilitários
     *************************/
    function $(sel, ctx=document) { return ctx.querySelector(sel); }
    function $all(sel, ctx=document) { return Array.from((ctx || document).querySelectorAll(sel)); }
    function saveCart() { localStorage.setItem('jfg_cart', JSON.stringify(cart)); }
    function totalCount() { return cart.reduce((s,it)=>s + (it.qty||0), 0); }
    function totalPrice() { return cart.reduce((s,it)=>s + (it.price||0)*(it.qty||0), 0); }

    function showToast(message) {
      toastMsg = message;
      renderToast();
      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ toastMsg=''; renderToast(); }, 2600);
    }

    /*************************
     * Carrinho
     *************************/
    function addToCart(product, chosenSizeId, qty = 1, options={fromDetail:false}) {
      const size = (product.sizes || []).find(s => s.id === chosenSizeId) || (product.sizes && product.sizes[0]);
      const price = size ? Number(size.price) : Number(product.basePrice || 0);
      const key = `${product.id}::${size ? size.id : 'default'}`;
      const found = cart.find(p => p.key === key);
      if (found) {
        found.qty = (found.qty || 1) + qty;
      } else {
        cart.push({
          key,
          id: product.id,
          title: product.title + (size ? ` — ${size.label}` : ''),
          price,
          qty,
          img: (product.images && product.images[0]) || '',
          sizeId: size ? size.id : null
        });
      }
      saveCart();
      // se adicionou do detalhe, fechar detalhe automaticamente
      if (options.fromDetail) {
        closeProductDetail();
      }
      // atualizar UI
      renderFloatingCart();
      renderHeader();
      showToast(`${product.title} (${size ? size.label : 'Único'}) adicionado ao carrinho`);
    }

    function updateQtyByKey(key, qty) {
      const q = Number(qty);
      if (isNaN(q) || q < 1) return;
      cart = cart.map(p => p.key === key ? {...p, qty: q} : p);
      saveCart();
      renderFloatingCart();
      renderHeader();
    }

    function changeQtyByKey(key, delta) {
      cart = cart.map(p => p.key === key ? {...p, qty: Math.max(1, (p.qty||1)+delta)} : p);
      saveCart();
      renderFloatingCart();
      renderHeader();
    }

    function removeFromCartByKey(key) {
      cart = cart.filter(p => p.key !== key);
      saveCart();
      renderFloatingCart();
      renderHeader();
    }

    function clearCart() {
      cart = [];
      saveCart();
      renderFloatingCart();
      renderHeader();
    }

    function checkoutToWhatsApp() {
      if (!cart.length) { showToast('Seu carrinho está vazio ☺️'); return; }
      const lines = [
        'Olá, tenho interesse em comprar:',
        ...cart.map((p,i) => `${i+1}) ${p.title} x${p.qty} — R$ ${(p.price * p.qty).toFixed(2)}`),
        `Total: R$ ${totalPrice().toFixed(2)}`,
        'Nome: ',
        'Endereço: ',
        'Observações: ',
      ];
      const text = encodeURIComponent(lines.join('\n'));
      const wa = `https://wa.me/${BRAND.waNumberClean}?text=${text}`;
      window.open(wa, '_blank');
    }

    /*************************
     * Roteamento (hash)
     *************************/
    function handleHashChange() {
      const h = window.location.hash.replace('#','');
      route = h || 'home';
      // minimiza cart automaticamente em rotas específicas
      if (['blog','about','careers'].includes(route)) {
        cartMinimized = true;
      } else {
        cartMinimized = false;
      }
      renderApp();
    }
    window.addEventListener('hashchange', handleHashChange);

    /*************************
     * Hero rotation
     *************************/
    setInterval(() => {
      heroIndex = (heroIndex + 1) % BRAND.heroTags.length;
      const el = document.querySelector('[data-hero-tag]');
      if (el) el.textContent = BRAND.heroTags[heroIndex];
    }, 3000);

    /*************************
     * Render principal
     *************************/
    function renderApp() {
      const root = document.getElementById('app');
      root.innerHTML = `
        <div class="min-h-screen">
          ${renderHeaderHtml()}
          <main id="main-content" class="pt-24"></main>
          ${renderFloatingCartHtml()}
          ${renderFooterHtml()}
          <div id="toast-root" class="fixed left-1/2 -translate-x-1/2 bottom-20 z-50"></div>
          <div id="overlay-root"></div>
        </div>
      `;
      attachHeaderEvents();
      renderPageContent();
      renderFloatingCart();
      renderToast();
    }

    function renderHeaderHtml() {
      return `
        <header class="fixed inset-x-0 top-0 z-40 bg-white/90 backdrop-blur border-b">
          <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
            <div class="flex items-center gap-3">
              <img src="${BRAND.logoImage}" alt="logo" class="w-10 h-10 rounded-full object-cover" onerror="this.src='https://via.placeholder.com/200x200?text=Logo'"/>
              <div>
                <div class="font-bold">${BRAND.name}</div>
                <div class="text-xs text-gray-600">Aliança Ferragens • Qualidade Garantida</div>
              </div>
            </div>
            <nav class="hidden sm:flex items-center gap-3 text-sm" role="navigation" aria-label="Main">
              <button data-nav="home" class="px-2 py-1 rounded ${route==='home'?'bg-orange-100 text-orange-600':'text-gray-700'}">Home</button>
              <button data-nav="shop" class="px-2 py-1 rounded ${route==='shop'?'bg-orange-100 text-orange-600':'text-gray-700'}">Loja</button>
              <button data-nav="blog" class="px-2 py-1 rounded ${route==='blog'?'bg-orange-100 text-orange-600':'text-gray-700'}">Blog</button>
              <button data-nav="about" class="px-2 py-1 rounded ${route==='about'?'bg-orange-100 text-orange-600':'text-gray-700'}">Sobre</button>
              <button data-nav="careers" class="px-2 py-1 rounded ${route==='careers'?'bg-orange-100 text-orange-600':'text-gray-700'}">Trabalhe Conosco</button>
              <div id="header-cart-count" class="ml-2 px-3 py-1 rounded-full bg-orange-500 text-white text-xs">Carrinho (${totalCount()})</div>
            </nav>
            <div class="sm:hidden flex items-center gap-2">
              <button data-nav="shop" class="px-3 py-1 rounded-full bg-orange-500 text-white text-sm">Loja</button>
              <button data-nav="careers" class="px-3 py-1 rounded-full border text-sm">Vagas</button>
            </div>
          </div>
        </header>
      `;
    }

    function attachHeaderEvents() {
      const navBtns = document.querySelectorAll('[data-nav]');
      navBtns.forEach(btn => {
        btn.onclick = () => {
          const dest = btn.getAttribute('data-nav');
          route = dest;
          // se for blog/about/careers, minimiza o cart
          if (['blog','about','careers'].includes(dest)) cartMinimized = true;
          else cartMinimized = false;
          window.location.hash = dest;
          renderApp();
        };
      });
    }

    function renderFooterHtml() {
      return `
        <footer class="mt-12 py-10">
          <div class="max-w-6xl mx-auto text-center text-sm text-gray-600">
            <div>© ${new Date().getFullYear()} ${BRAND.name} — Design inspirado em social feeds • Paleta laranja</div>
            <div class="mt-3 flex items-center justify-center gap-3">
              <button id="footer-about" class="underline">Sobre</button>
              <button id="footer-careers" class="underline">Trabalhe Conosco</button>
            </div>
          </div>
        </footer>
      `;
    }

    function renderFloatingCartHtml() {
      return `<div id="floating-cart-root" class="fixed right-4 bottom-6 z-50"></div>`;
    }

    /*************************
     * Paginas
     *************************/
    function renderPageContent() {
      const main = document.getElementById('main-content');
      main.innerHTML = '';
      if (route === 'home') {
        main.appendChild(renderHome());
      } else if (route === 'shop') {
        main.appendChild(renderShop());
      } else if (route === 'blog') {
        main.appendChild(renderBlog());
      } else if (route === 'about') {
        main.appendChild(renderAbout());
      } else if (route === 'careers') {
        main.appendChild(renderCareers());
      } else {
        main.appendChild(renderHome());
      }

      // footer buttons events
      setTimeout(()=> {
        const fa = document.getElementById('footer-about');
        if (fa) fa.onclick = ()=> { window.location.hash='about'; route='about'; cartMinimized = true; renderApp(); };
        const fc = document.getElementById('footer-careers');
        if (fc) fc.onclick = ()=> { window.location.hash='careers'; route='careers'; cartMinimized = true; renderApp(); };
      },0);
    }

    function renderHome() {
      const container = document.createElement('div');
      container.className = 'snap-y snap-mandatory h-screen overflow-y-auto touch-pan-y';

      // Hero
      const hero = document.createElement('section');
      hero.className = 'snap-start min-h-[60vh] flex items-center justify-center px-4';
      hero.innerHTML = `
        <div class="max-w-6xl w-full grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
          <div class="space-y-4">
            <span class="px-3 py-1 rounded-full bg-orange-50 text-orange-600 text-xs font-semibold" data-hero-tag>${BRAND.heroTags[heroIndex]}</span>
            <h1 data-hero-headline class="text-3xl md:text-5xl font-extrabold leading-tight transition-transform duration-300">As Melhores Grapas & Suportes</h1>
            <p class="text-gray-600">Produzimos suportes e ferragens para marmoristas e construtoras. Venda por atacado e varejo, com garantia de qualidade.</p>
            <div class="flex gap-3">
              <button id="home-explore" data-tap class="px-4 py-2 rounded-full bg-orange-500 text-white font-semibold shadow">Explorar coleção</button>
              <button id="home-saiba" class="px-4 py-2 rounded-full border">Saiba mais</button>
            </div>
          </div>
          <div class="rounded-2xl overflow-hidden shadow-lg bg-white">
            <img src="${BRAND.logoImage}" alt="hero" class="w-full h-[420px] object-cover" onerror="this.src='https://via.placeholder.com/800x420?text=Hero'"/>
          </div>
        </div>
      `;
      container.appendChild(hero);

      // Destaques (home)
      const highlights = document.createElement('section');
      highlights.className = 'snap-start min-h-[70vh] px-4 py-6';
      const cardsHtml = featured.map(p => renderProductCard(p).outerHTML).join('');
      highlights.innerHTML = `
        <div class="max-w-6xl mx-auto">
          <h2 class="text-2xl font-bold mb-4">Destaques</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">${cardsHtml}</div>
          <div class="mt-6 text-right">
            <button id="ver-loja-home" class="px-4 py-2 rounded-full border">Ver todos os produtos</button>
          </div>
        </div>
      `;
      container.appendChild(highlights);

      // Avaliações -> CTA
      const cta = document.createElement('section');
      cta.className = 'snap-start min-h-[30vh] px-4 py-8 bg-white flex items-center';
      cta.innerHTML = `
        <div class="max-w-6xl mx-auto w-full flex items-center justify-between">
          <div>
            <h3 class="text-xl font-bold">Gostou da nossa loja?</h3>
            <p class="text-gray-600">Deixe sua avaliação no WhatsApp — ajuda muito a gente crescer.</p>
          </div>
          <div>
            <button id="cta-review" class="px-4 py-2 rounded-full bg-orange-500 text-white">Avaliar via WhatsApp</button>
          </div>
        </div>
      `;
      container.appendChild(cta);

      // Eventos
      setTimeout(()=> {
        const explore = container.querySelector('#home-explore');
        if (explore) {
          explore.onclick = () => { route='shop'; window.location.hash='shop'; cartMinimized = false; renderApp(); };
          explore.addEventListener('mousedown', ()=> explore.classList.add('pressed'));
          explore.addEventListener('mouseup', ()=> explore.classList.remove('pressed'));
          explore.addEventListener('mouseleave', ()=> explore.classList.remove('pressed'));
        }
        const saiba = container.querySelector('#home-saiba');
        if (saiba) saiba.onclick = ()=> { route='about'; window.location.hash='about'; cartMinimized = true; renderApp(); };

        const verLoja = container.querySelector('#ver-loja-home');
        if (verLoja) verLoja.onclick = ()=> { route='shop'; window.location.hash='shop'; cartMinimized = false; renderApp(); };

        const ctaReview = container.querySelector('#cta-review');
        if (ctaReview) ctaReview.onclick = ()=> {
          const text = encodeURIComponent('Quero deixar uma avaliação: ');
          window.open(`https://wa.me/${BRAND.waNumberClean}?text=${text}`, '_blank');
        };
      },0);

      return container;
    }

    function renderShop() {
      const container = document.createElement('div');
      container.className = 'px-4 py-8';
      container.innerHTML = `
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold mb-4">Loja — Todos os Produtos</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            ${products.map(p => renderProductCard(p).outerHTML).join('')}
          </div>
        </div>
      `;
      // attach events for generated elements
      setTimeout(()=> {
        $all('.add-to-cart').forEach(btn => {
          btn.onclick = (e) => {
            const id = Number(btn.getAttribute('data-id'));
            const product = products.find(p=>p.id===id);
            // pegar size default
            const chosenSize = (product.sizes && product.sizes[0]) ? product.sizes[0].id : null;
            addToCart(product, chosenSize, 1, {fromDetail:false});
          };
        });
        $all('.view-product').forEach(btn => {
          btn.onclick = (e) => {
            const id = Number(btn.getAttribute('data-id'));
            showProductDetail(id);
          };
        });
        $all('.card-title').forEach(title => {
          title.onclick = () => {
            const id = Number(title.closest('article').querySelector('.view-product').getAttribute('data-id'));
            showProductDetail(id);
          };
        });
      },0);
      return container;
    }

    function renderBlog() {
      const section = document.createElement('section');
      section.className = 'pt-24 px-4 pb-12 max-w-4xl mx-auto space-y-4';
      const posts = [
        { id: 1, title: 'Como usar cores para vender mais', excerpt: 'Técnicas rápidas e práticas para aplicar paletas que convertem.' },
        { id: 2, title: 'Fotografia para ecommerce', excerpt: 'Dicas para fotos estilo social feed que chamam atenção.' },
      ];
      section.innerHTML = `
        <h2 class="text-3xl font-bold mb-4">Blog</h2>
        ${posts.map(p => `
          <article class="bg-white rounded-xl p-4 shadow">
            <h3 class="font-semibold text-lg">${p.title}</h3>
            <p class="text-gray-600 mt-2">${p.excerpt}</p>
            <div class="mt-3"><button class="text-orange-600">Ler mais →</button></div>
          </article>
        `).join('')}
      `;
      return section;
    }

    function renderAbout() {
      // About page: title, text, image in the middle, more text after image.
      cartMinimized = true;
      const container = document.createElement('div');
      container.className = 'px-4 py-12';
      container.innerHTML = `
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-bold mb-4">Sobre a JFG Metais</h2>
          <p class="text-gray-700 mb-4">A JFG Metais atua há anos fornecendo suportes de metal para o setor da construção civil, marmoristas e indústrias. Nosso compromisso é com qualidade, durabilidade e atendimento próximo ao cliente.</p>

          <div class="my-6">
            <img src="https://via.placeholder.com/900x420?text=Equipe+JFG+Metais" alt="Equipe JFG Metais" class="w-full rounded-lg shadow" />
          </div>

          <p class="text-gray-700">Após muitos anos de dedicação e aprimoramento dos processos, desenvolvemos linhas de produtos que passam por inspeção e controle de qualidade rigorosos. Nossos clientes confiam na consistência e no suporte que oferecemos.</p>

          <p class="text-gray-700 mt-4">Se desejar, entre em contato e peça uma cotação personalizada. Temos condições para atacado e varejo, além de entrega agendada para obras.</p>
        </div>
      `;
      return container;
    }

    function renderCareers() {
      const container = document.createElement('div');
      container.className = 'px-4 py-12 max-w-6xl mx-auto';
      container.innerHTML = `
        <h2 class="text-2xl font-bold mb-4">Trabalhe Conosco</h2>
        <p class="mb-4 text-gray-600">Estamos sempre em busca de pessoas comprometidas e proativas. Envie seu currículo pelo WhatsApp.</p>
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold">Vagas Abertas</h3>
          <ul class="list-disc pl-6 mt-2 text-sm text-gray-700">
            <li>Auxiliar de Produção</li>
            <li>Vendedor Externo</li>
            <li>Assistente Administrativo</li>
          </ul>
          <div class="mt-4">
            <button id="jobs-wa" class="px-4 py-2 rounded-full bg-orange-500 text-white">Enviar currículo via WhatsApp</button>
          </div>
        </div>
      `;
      setTimeout(()=> {
        const btn = container.querySelector('#jobs-wa');
        if (btn) btn.onclick = ()=> {
          const text = encodeURIComponent('Olá, quero me candidatar à vaga. Segue meu nome e contato: ');
          window.open(`https://wa.me/${BRAND.waNumberClean}?text=${text}`, '_blank');
        };
      },0);
      return container;
    }
    
    function renderCareers() {
      const section = document.createElement('section');
      section.className = 'pt-24 px-4 pb-16 max-w-4xl mx-auto';
      section.innerHTML = `
        <div class="bg-white p-6 rounded-2xl shadow space-y-4">
          <h1 class="text-2xl font-bold">Trabalhe Conosco</h1>
          <p class="text-gray-600">Quer fazer parte do time JFG Metais? Envie seu currículo abaixo — analisamos perfis para produção, vendas e logística. Ao submeter, entraremos em contato caso seu perfil seja compatível.</p>
          <form id="careers-form" class="space-y-3">
            <div>
              <label class="text-sm font-medium">Nome completo</label>
              <input id="applicant-name" class="w-full rounded-md border px-3 py-2" required />
            </div>
            <div>
              <label class="text-sm font-medium">E-mail</label>
              <input id="applicant-email" type="email" class="w-full rounded-md border px-3 py-2" required />
            </div>
            <div>
              <label class="text-sm font-medium">Anexe seu currículo (PDF ou DOC)</label>
              <input id="applicant-cv" type="file" accept=".pdf,.doc,.docx" class="w-full" />
              <div id="cv-name" class="text-xs text-gray-500 mt-1"></div>
            </div>
            <div class="flex gap-2">
              <button type="submit" class="px-4 py-2 rounded-full bg-orange-500 text-white">Enviar currículo</button>
              <button type="button" id="careers-back" class="px-4 py-2 rounded-full border">Voltar</button>
            </div>
          </form>
        </div>
      `;

      setTimeout(()=> {
        const form = section.querySelector('#careers-form');
        const cvInput = section.querySelector('#applicant-cv');
        const cvName = section.querySelector('#cv-name');
        cvInput.addEventListener('change', (e) => {
          const f = e.target.files[0];
          cvName.textContent = f ? `Arquivo: ${f.name}` : '';
        });
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const name = section.querySelector('#applicant-name').value.trim();
          const email = section.querySelector('#applicant-email').value.trim();
          const file = section.querySelector('#applicant-cv').files[0];
          // Simulação: aqui você pode implementar upload real para servidor.
          showToast('Currículo enviado. Agradecemos seu interesse!');
          // limpar formulário
          form.reset();
          cvName.textContent = '';
        });
        section.querySelector('#careers-back').onclick = ()=> { window.history.back(); };
      }, 0);

      return section;
    }

    /*************************
     * Product card & detail
     *************************/
    function renderProductCard(product) {
      const article = document.createElement('article');
      article.className = 'bg-white rounded-2xl p-3 shadow hover:shadow-lg transition-shadow';
      const img = (product.images && product.images[0]) || 'https://via.placeholder.com/800x640?text=Produto';
      article.innerHTML = `
        <div class="relative rounded-xl overflow-hidden">
          <img src="${img}" alt="${product.title}" class="w-full h-64 object-cover" onerror="this.src='https://via.placeholder.com/800x640?text=Produto'"/>
          ${product.tag ? `<span class="absolute top-3 left-3 px-2 py-1 text-xs rounded bg-orange-500 text-white">${product.tag}</span>` : ''}
        </div>
        <div class="mt-3">
          <h3 class="font-semibold cursor-pointer card-title">${product.title}</h3>
          <p class="text-sm text-gray-600 mt-1 desc" style="display:none">${product.excerpt || ''}</p>
          <div class="flex items-center justify-between mt-2">
            <div class="text-lg font-bold">R$ ${(product.sizes && product.sizes[0] ? product.sizes[0].price : product.basePrice || 0).toFixed(2)}</div>
            <div class="flex items-center gap-2">
              <button class="px-3 py-1 rounded-full border view-product" data-id="${product.id}">Ver</button>
              <button class="px-3 py-1 rounded-full bg-orange-500 text-white text-sm add-to-cart" data-id="${product.id}">Comprar</button>
            </div>
          </div>
        </div>
      `;
      return article;
    }

    function showProductDetail(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      // when opening detail, minimize cart
      cartMinimized = true;
      renderFloatingCart();

      const overlayRoot = document.getElementById('overlay-root');
      overlayRoot.innerHTML = `
        <div class="overlay-backdrop" id="detail-backdrop" aria-modal="true" role="dialog">
          <div class="detail-card">
            <div class="flex items-start justify-between gap-3 mb-4">
              <div>
                <h3 class="text-2xl font-bold">${product.title}</h3>
                <div class="text-sm text-gray-600 mt-1">${product.category} • ${product.tag || ''}</div>
              </div>
              <div class="flex items-center gap-2">
                <button id="close-detail" class="px-3 py-1 rounded-full border">Fechar</button>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <div class="rounded overflow-hidden mb-3">
                  <img id="detail-main-img" src="${product.images && product.images[0] ? product.images[0] : 'https://via.placeholder.com/800x640?text=Produto'}" alt="${product.title}" class="w-full h-[360px] object-cover rounded" onerror="this.src='https://via.placeholder.com/800x640?text=Produto'"/>
                </div>
                <div class="flex gap-2 overflow-x-auto">
                  ${ (product.images || []).map((src, i) => `<button class="p-0 border rounded overflow-hidden thumb-btn" data-src="${src}"><img src="${src}" alt="thumb-${i}" class="w-20 h-20 object-cover"/></button>`).join('') }
                </div>
              </div>

              <div>
                <p class="text-gray-700 mb-2">${product.excerpt || ''}</p>
                <div class="mb-3">
                  <label class="text-sm font-semibold block mb-1">Escolha o tamanho / opção</label>
                  <div id="detail-sizes" class="flex flex-col gap-2">
                    ${ (product.sizes || []).map(s => `
                      <label class="inline-flex items-center gap-2 p-2 border rounded cursor-pointer size-option">
                        <input type="radio" name="size-${product.id}" value="${s.id}" ${s === (product.sizes[0]) ? 'checked' : ''} />
                        <span>${s.label} — R$ ${Number(s.price).toFixed(2)}</span>
                      </label>
                    `).join('') }
                    ${(!product.sizes || !product.sizes.length) ? `<div class="text-sm">Sem variações — R$ ${Number(product.basePrice || 0).toFixed(2)}</div>` : ''}
                  </div>
                </div>

                <div class="flex items-center gap-3 mb-4">
                  <div class="flex items-center border rounded">
                    <button id="qty-decrease" class="px-3">-</button>
                    <input id="qty-input" type="number" value="1" min="1" class="w-14 text-center p-2" />
                    <button id="qty-increase" class="px-3">+</button>
                  </div>
                </div>

                <div class="flex gap-3">
                  <button id="detail-add" class="px-4 py-2 rounded-full bg-orange-500 text-white font-semibold">Adicionar ao carrinho</button>
                  <button id="detail-buy" class="px-4 py-2 rounded-full border">Comprar via WhatsApp</button>
                </div>

              </div>
            </div>

            <div class="mt-6">
              <h4 class="font-semibold">Descrição completa</h4>
              <p class="text-gray-700 mt-2">Descrição longa do produto com informações técnicas, medidas e recomendações de uso.</p>
            </div>
          </div>
        </div>
      `;

      // attach events
      setTimeout(()=>{
        const backdrop = document.getElementById('detail-backdrop');
        const closeBtn = document.getElementById('close-detail');
        if (closeBtn) closeBtn.onclick = closeProductDetail;

        // thumbnails switch
        $all('.thumb-btn').forEach(b => {
          b.onclick = () => {
            const src = b.getAttribute('data-src');
            const main = document.getElementById('detail-main-img');
            if (main) main.src = src;
          };
        });

        const qtyInput = document.getElementById('qty-input');
        const dec = document.getElementById('qty-decrease');
        const inc = document.getElementById('qty-increase');
        if (dec) dec.onclick = ()=> { qtyInput.value = Math.max(1, (Number(qtyInput.value)||1)-1); };
        if (inc) inc.onclick = ()=> { qtyInput.value = (Number(qtyInput.value)||1)+1; };

        const addBtn = document.getElementById('detail-add');
        if (addBtn) addBtn.onclick = ()=> {
          const sizeRad = document.querySelector(`input[name="size-${product.id}"]:checked`);
          const chosenSize = sizeRad ? sizeRad.value : (product.sizes && product.sizes[0] ? product.sizes[0].id : null);
          const qty = Math.max(1, Number(document.getElementById('qty-input').value) || 1);
          addToCart(product, chosenSize, qty, {fromDetail:true});
        };

        const buyBtn = document.getElementById('detail-buy');
        if (buyBtn) buyBtn.onclick = ()=> {
          const sizeRad = document.querySelector(`input[name="size-${product.id}"]:checked`);
          const chosenSize = sizeRad ? sizeRad.value : (product.sizes && product.sizes[0] ? product.sizes[0].id : null);
          const sizeObj = (product.sizes || []).find(s => s.id === chosenSize) || null;
          const qty = Math.max(1, Number(document.getElementById('qty-input').value) || 1);
          const lines = [
            `Olá, tenho interesse no produto: ${product.title}${sizeObj ? ' — ' + sizeObj.label : ''} x${qty}`,
            `Preço unitário: R$ ${sizeObj ? Number(sizeObj.price).toFixed(2) : Number(product.basePrice||0).toFixed(2)}`,
            `Total: R$ ${( (sizeObj ? Number(sizeObj.price) : Number(product.basePrice||0)) * qty ).toFixed(2)}`,
            'Nome: ',
            'Endereço: ',
            'Observações: '
          ];
          window.open(`https://wa.me/${BRAND.waNumberClean}?text=${encodeURIComponent(lines.join('\n'))}`, '_blank');
        };
      },0);
    }

    function closeProductDetail() {
      const overlayRoot = document.getElementById('overlay-root');
      overlayRoot.innerHTML = '';
      // quando fechar detalhe, restaurar comportamento do cart (voltar ao default de rota)
      // se a rota for shop/home não minimiza
      if (!['blog','about','careers'].includes(route)) cartMinimized = false;
      renderFloatingCart();
    }

    /*************************
     * Floating cart render
     *************************/
    function toggleCartMinimized() {
      cartMinimized = !cartMinimized;
      renderFloatingCart();
    }

    function renderFloatingCart() {
      const root = document.getElementById('floating-cart-root');
      if (!root) return;
      // if minimized and no items, still show minimized empty state
      if (cartMinimized) {
        // minimized view (compact)
        root.innerHTML = `
          <div class="cart-root cart-minimized bg-white border p-2" role="region" aria-label="Carrinho minimizado">
            <div class="flex items-center justify-between gap-2">
              <div class="text-sm font-semibold">Carrinho</div>
              <div class="flex items-center gap-2">
                <div class="text-sm text-gray-600">R$ ${totalPrice().toFixed(2)}</div>
                <button id="toggle-cart" class="px-2 py-1 rounded-full border text-xs">Abrir</button>
              </div>
            </div>
          </div>
        `;
        // attach open
        setTimeout(()=> {
          const toggle = document.getElementById('toggle-cart');
          if (toggle) toggle.onclick = ()=> { cartMinimized = false; renderFloatingCart(); };
        },0);
        return;
      }

      // expanded cart view
      root.innerHTML = `
        <div class="cart-root cart-expanded bg-white border">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Carrinho (${totalCount()})</div>
            <div class="flex items-center gap-2">
              <div class="text-sm text-gray-600">Total: R$ ${totalPrice().toFixed(2)}</div>
              <button id="minimize-cart" class="px-2 py-1 rounded-full border text-xs">Minimizar</button>
            </div>
          </div>

          <div class="cart-items thin-scroll mb-3">
            ${ cart.length ? cart.map(item => `
              <div class="flex items-center gap-3 p-2 border-b last:border-b-0">
                <img src="${item.img || 'https://via.placeholder.com/120x120?text=Img'}" alt="${item.title}" class="w-14 h-14 object-cover rounded" />
                <div class="flex-1">
                  <div class="font-medium text-sm">${item.title}</div>
                  <div class="text-xs text-gray-600">R$ ${Number(item.price).toFixed(2)} x ${item.qty} = R$ ${(item.price*item.qty).toFixed(2)}</div>
                </div>
                <div class="flex flex-col items-end gap-1">
                  <div class="flex gap-1">
                    <button class="px-2 py-1 border qty-decrease" data-key="${item.key}">-</button>
                    <input class="w-12 text-center qty-input border p-1" data-key="${item.key}" value="${item.qty}" />
                    <button class="px-2 py-1 border qty-increase" data-key="${item.key}">+</button>
                  </div>
                  <button class="text-red-500 text-xs remove-item" data-key="${item.key}">Remover</button>
                </div>
              </div>
            `).join('') : `<div class="text-sm text-gray-600 p-3">Carrinho vazio</div>` }
          </div>

          <div class="mt-auto flex items-center gap-2">
            <button id="checkout-wa" class="flex-1 px-3 py-2 rounded-full bg-green-600 text-white">Finalizar (WhatsApp)</button>
            <button id="clear-cart" class="px-3 py-2 rounded-full border">Limpar</button>
          </div>
        </div>
      `;

      // attach events
      setTimeout(()=>{
        const minimize = document.getElementById('minimize-cart');
        if (minimize) minimize.onclick = ()=> { cartMinimized = true; renderFloatingCart(); };

        const clearBtn = document.getElementById('clear-cart');
        if (clearBtn) clearBtn.onclick = ()=> { if (confirm('Limpar carrinho?')) clearCart(); };

        const checkout = document.getElementById('checkout-wa');
        if (checkout) checkout.onclick = checkoutToWhatsApp;

        $all('.qty-decrease').forEach(b => {
          b.onclick = ()=> { changeQtyByKey(b.getAttribute('data-key'), -1); };
        });
        $all('.qty-increase').forEach(b => {
          b.onclick = ()=> { changeQtyByKey(b.getAttribute('data-key'), +1); };
        });
        $all('.qty-input').forEach(inp => {
          inp.onchange = ()=> updateQtyByKey(inp.getAttribute('data-key'), inp.value);
        });
        $all('.remove-item').forEach(b => {
          b.onclick = ()=> { removeFromCartByKey(b.getAttribute('data-key')); };
        });
      },0);
    }

    /*************************
     * Toast
     *************************/
    function renderToast() {
      const root = document.getElementById('toast-root');
      if (!root) return;
      if (!toastMsg) {
        root.innerHTML = '';
        return;
      }
      root.innerHTML = `<div class="bg-black text-white px-4 py-2 rounded shadow">${toastMsg}</div>`;
    }

    /*************************
     * Inicialização
     *************************/
    // inicial route a partir do hash
    const initialHash = window.location.hash.replace('#','') || 'home';
    route = initialHash;
    if (['blog','about','careers'].includes(route)) cartMinimized = true;
    renderApp();

    // keep header count updated globally (observes local changes)
    // small loop to update header count for dynamic updates from other functions
    setInterval(()=> {
      const hc = document.getElementById('header-cart-count');
      if (hc) hc.innerText = `Carrinho (${totalCount()})`;
      // also keep minimized summary updated (if visible)
      const root = document.getElementById('floating-cart-root');
      if (root && root.innerHTML && cartMinimized) {
        // re-render to refresh total shown in minimized
        // but avoid too frequent re-renders: only if totals changed
        // simple approach: always refresh when interval fires (lightweight)
        // (could optimize)
        renderFloatingCart();
      }
    }, 800);

    // expose small helpers for debugging (optional)
    window._JFG = {
      products, cart, addToCart, showProductDetail, renderFloatingCart
    };
  </script>

</body>
</html>
